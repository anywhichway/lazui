<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Title</title>
</head>
<body>
Welcome to flexroute-test.html
<script type="module">
    import {flexroute} from "./flexroute.js";
    const router = flexroute()
        .withServers({balance:"lfru"},{url:"http://localhost:8081",race:true},{url:`ws://${location.hostname}:${parseInt(location.port)+1}`,race:true}); // ,`ws://${location.hostname}:${parseInt(location.port)+1}`
    document.addEventListener("click",async (event) => {
        if(event.target.tagName==="A") {
            event.preventDefault();
            const response = await router.fetch(new URL(event.target.href).href),
                target = event.target.target,
                targetEl = target ? document.querySelector(target) : document.body;
            if(response) {
                if(response instanceof WebSocket) {
                    response.onmessage = (message) => {
                        message = JSON.parse(message.data);
                        if(message.url===event.target.href) {
                            targetEl.innerText = message.data;
                        }
                    }
                    return;
                }
                targetEl.innerText = await response.text()
            }
        }
        console.log(router.remotes)
    });
</script>
<br>
<a href="http://localhost:8081/test" target="#message">Hello World</a> <span id="message"></span><br>
<a href="http://localhost:8081/sse" target="#event">SSE</a> <span id="event"></span><br>
</body>
</html>